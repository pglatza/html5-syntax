datatypes w = "http://whattf.org/datatype-draft"

# #####################################################################
##  RELAX NG Schema for HTML 5: Advanced Embedded Content             #
# #####################################################################

## Attributes Common to Media Elements

	# src not included
	media.attrs = 
		(	media.attrs.autoplay?
		&	media.attrs.start?
		&	media.attrs.loopstart?
		&	media.attrs.loopend?
		&	media.attrs.playcount?
		&	media.attrs.controls?
		)
		media.attrs.autoplay   =
			attribute autoplay   {
				w:string "autoplay" | w:string ""
			}
		media.attrs.start   =
			attribute start   {
				common.data.timeoffset
			}
		media.attrs.loopstart  =
			attribute loopstart  {
				common.data.timeoffset
			}
		media.attrs.loopend  =
			attribute loopend  {
				common.data.timeoffset
			}
		media.attrs.end  =
			attribute end  {
				common.data.timeoffset
			}
		media.attrs.playcount  =
			attribute playcount  {
				common.data.integer.positive
			}
		media.attrs.controls  =
			attribute controls  {
				w:string "controls" | w:string ""
			}
		
## Source: <source>

	source.elem =
		element source { source.inner & source.attrs }
	source.elem.last =
		element source { source.inner & source.last.attrs }
	source.attrs =
		(	common.attrs
		&	source.attrs.src
		&	(	(	source.attrs.type
				&	source.attrs.media?
				)
			|	(	source.attrs.media
				)
			)
		)
	source.last.attrs =
		(	common.attrs
		&	source.attrs.src
		&	source.attrs.type?
		&	source.attrs.media?
		)
		source.attrs.src =
			attribute src {
				common.data.uri
			}
		source.attrs.type =
			attribute type {
				common.data.mimetype
			}
		source.attrs.media =
			attribute media {
				common.data.mediaquery
			}
	source.inner =
		( empty )

## Media Source

	media.source = 
		(	media.attrs.src
		|	(	source.elem*
			,	source.elem.last
			)
		)

	media.attrs.src =
		attribute src {
			common.data.uri
		}

## Video: <video>

	video.elem.strict-inline =
		element video { video.inner.strict-inline & video.attrs }
	video.elem.struct-inline =
		element video { video.inner.struct-inline & video.attrs }
	video.elem.embedded =
		element video { video.inner.embedded & video.attrs }
	video.attrs =
		(	common.attrs
		&	media.attrs
		&	video.attrs.poster?
		&	video.attrs.height?
		&	video.attrs.width?
		)
		video.attrs.poster =
			attribute poster {
				common.data.uri
			}
		video.attrs.height =
			attribute height {
				common.data.integer.positive
			}
		video.attrs.width =
			attribute width {
				common.data.integer.positive
			}
	video.inner.strict-inline =
		(	media.source
		,	common.inner.strict-inline
		)
	video.inner.struct-inline =
		(	media.source
		,	common.inner.struct-inline
		)
	video.inner.embedded =
		(	media.source
		,	common.elem.embedded
		)

	common.elem.strict-inline |= video.elem.strict-inline
	common.elem.struct-inline |= video.elem.struct-inline
	common.elem.embedded |= video.elem.embedded

## Audio: <audio>

	audio.elem.strict-inline =
		element audio { audio.inner.strict-inline & audio.attrs }
	audio.elem.struct-inline =
		element audio { audio.inner.struct-inline & audio.attrs }
	audio.elem.embedded =
		element audio { audio.inner.embedded & audio.attrs }
	audio.attrs =
		(	common.attrs
		&	media.attrs
		)
	audio.inner.strict-inline =
		(	media.source
		,	common.inner.strict-inline
		)
	audio.inner.struct-inline =
		(	media.source
		,	common.inner.struct-inline
		)
	audio.inner.embedded =
		(	media.source
		,	common.elem.embedded
		)

	common.elem.strict-inline |= audio.elem.strict-inline
	common.elem.struct-inline |= audio.elem.struct-inline
	common.elem.embedded |= audio.elem.embedded

## Captioned Embedded Content: <figure>

	figure.elem =
		element figure { figure.inner & figure.attrs }
	figure.attrs =
		( common.attrs )
	figure.inner =
		( common.elem.embedded & legend.elem.struct-inline )

	common.elem.block |= figure.elem
